# Предсказание цен на авто с помощью линейных моделей


### Постановка задачи

>Необходимо предсказать цену автомобиля (`selling_price`) по его характеристикам на основе табличных данных и построить интерпретируемую модель, сравнить линейные методы с разными видами регуляризации

**Решается задача регрессии**

###  EDA и предобработка данных

>На первом этапе был проведён **простейший EDA** и базовая обработка данных с использованием `pandas`
Был просмотрен датасет (head, tail. sample), проведена проверка на пропуски и дубликаты, а также построен автоматический EDA-отчёт с помощью **ydata-profiling**

### Основные выводы

>Просмотр датасета позволил понять формат данных по столбцам,  выявить необходимость преобразования типов и формата данных, принять решение об  масштабировании, энкодинге и очистке признаков, но для выявления выбросов и скрытых аномалий уже требуется статистический анализ
 Проверка с помощью `duplicated()` не всегда достаточна, так как возможны дубликаты по признакам при разных значениях таргета


###  Очистка и инженерия признаков

>Все этапы предобработки выполнялись **одинаково для тренировочного и тестового датасетов**, чтобы избежать утечек и несоответствий данных 
В ходе обработки числовые признаки `mileage`, `engine` и `max_power` были очищены от единиц измерения и приведены к типу `float` или `int` 
Столбец `torque` был обработан с помощью кастомной функции, с помощью которой из строкового представления извлекались числовые значения крутящего момента в Н м (`torque_Nm`) и соответствующие обороты двигателя (`rpm`), после чего исходный столбец `torque` был удалён
Также были обработаны пропущенные значения заполнением медианой и приведены типы данных для признаков `engine` и `seats`


###  Работа с дубликатами

>В тренировочном датасете были обнаружены объекты с полностью одинаковым признаковым описанием (без учёта целевой переменной)
Повторяющиеся строки были удалены, при этом в случаях, когда при одинаковых признаках встречались разные значения цены, сохранялась первая запись
После удаления дубликатов индексы датасета были переупорядочены и приведены к последовательному виду без пропусков


###  Статистики и распределения

> **Числовые признаки.**  
> В данных выявлены аномалии и выбросы: например, встречаются автомобили с `max_power = 0`, а также крайне большие значения пробега (`km_driven` до 3 млн км)
>  При этом распределения числовых признаков в train и test в целом похожи. Тем не менее, данные требуют дополнительной проверки и, возможно, обработки выбросов (например, с использованием IQR)

> **Категориальные признаки.**  
> Существенного сдвига распределений между train и test не обнаружено. В тестовой выборке относительное число уникальных категорий выше, чем в трейне. Также выявлен заметный дисбаланс в признаке `seller_type`


###  Визуальный анализ (pairplot)

>В данных наблюдается выраженная зависимость целевой переменной `selling_price` от года выпуска автомобиля (`year`), пробега (`km_driven`) и мощности двигателя (`max_power`). Также обнаружена сильная корреляция между двигательными признаками `engine`, `torque_Nm` и `max_power`, что указывает на возможную мультиколлинеарность.

>Наименее скоррелированной парой признаков оказались `engine` и `year` (коэффициент корреляции около 0.025). При этом между `max_power` и `selling_price` наблюдается сильная положительная линейная зависимость (≈ 0.69).
Распределения признаков в train и test выборках в целом схожи, однако тестовая выборка выглядит более разреженной.


###  Обучение моделей
#### Linear Regression

- R² ≈ **0.60**
- Переобучения не наблюдается
- RMSE очень высокий (≈ 92% от среднего таргета)
- Модель объясняет структуру данных, но **точность низкая**

#### Стандартизация

- Применена (fit только на train)
- Существенного прироста качества не дала
- Позволила интерпретировать веса (ключевой признак, `max_power`)
###  Регуляризация и подбор гиперпараметров
#### Ridge (L2)

|Метрика|Значение|
|---|---|
|Лучший `alpha`|**2.07**|
|R² (CV)|**0.712**|
|R² (test)|**0.775**|
|RMSE (test)|**359 639**|
#### Lasso (L1)

| Метрика        | Значение                                         |
| -------------- | ------------------------------------------------ |
| Лучший `alpha` | **0.01**                                         |
| R² (CV)        | **0.708**                                        |
| R² (test)      | **0.786**                                        |
| RMSE (test)    | **350 323**                                      |
| Особенность    | Обнуляет часть коэффициентов (feature selection) |

#### ElasticNet

|Метрика|Значение|
|---|---|
|`alpha`|**0.01**|
|`l1_ratio`|**0.9**|
|R² (CV)|**0.710**|
|R² (test)|**0.759**|
|RMSE (test)|**371 860**|

#### Итого:
-->**Ridge показал наиболее стабильное и интерпретируемое качество**, что говорит в пользу L2-регуляризации для данной задачи.

###  Бизнес-метрика
Требование состояло в том, чтобы вычислялась доля объектов, где ошибка ≤ 10% от реальной цены:

|Модель|Business metric|
|---|---|
|Lasso|**0.315**|
|Ridge|0.291|
|ElasticNet|0.279|

#### **Что дало наибольший прирост качества?**
>Наибольший прирост качества дала корректная работа с признаками и регуляризацией.  
В первую очередь это **One-Hot Encoding категориальных признаков**, который позволил линейной модели корректно учитывать категориальную информацию. Существенный вклад внесла **L2-регуляризация (Ridge)**, снизившая переобучение и стабилизировавшая веса модели. Дополнительно качество улучшилось за счёт **грид-сёрча по параметру `alpha`**, позволившего подобрать оптимальную степень регуляризации



#### **Что не удалось?**
>В ходе работы выявился ряд ограничений и направлений для улучшения. Полноценная обработка выбросов (например, с использованием IQR или trimming) не была выполнена, что потенциально влияет на устойчивость модели
>Признак `name` был обработан упрощённо, без учёта модели авто, только марка
>Также линейные модели в целом ограничены в способности улавливать нелинейные зависимости между признаками и целевой переменной

#### **Возможные улучшения:**
>В качестве дальнейших шагов целесообразно рассмотреть системную работу с выбросами, использование Target Encoding или CatBoost Encoding для категориальных признаков, а также переход к нелинейным моделям (GBM, CatBoost)
>Дополнительным направлением улучшения может стать логарифмирование целевой переменной для стабилизации распределения ошибок